{"version":3,"file":"bundle.js","sources":["airtableClient.js","loadAndProcessData.js","index.js"],"sourcesContent":["var Airtable = require('airtable');\n\nAirtable.configure({\n    endpointUrl: 'https://api.airtable.com',\n    apiKey: 'keyiUyROsiT6hATuI'\n});\nvar base = Airtable.base('appIo1lqaLGrB5dLz');\n\n\nexport const getPopPerCap = () => {\n  return new Promise( (resolve, reject) => {\n    let results = []\n\n    base('Table 1').select({\n        view: 'Grid view'\n    }).firstPage(function(err, records)\n    {    if (err) { console.error(err); return; }\n        records.map(function(record) {\n            results.push({state: record.get('State'), jailPop: record.get('Jail Population per capita')});\n        });\n    });\n    console.log('results received')\n    resolve(results);\n  })\n}","import { feature } from 'topojson';\nimport { tsv, json } from 'd3';\nimport { getPopPerCap } from './airtableClient';\n\nexport const loadAndProcessData = (render =>\n  json('https://cdn.jsdelivr.net/npm/us-atlas@3/states-albers-10m.json')\n    .then((topoJSONdata) => {\n      const states = feature(topoJSONdata, topoJSONdata.objects.states);\n\n      fetch(\"https://api.airtable.com/v0/appIo1lqaLGrB5dLz/Table%201?maxRecords=100&view=Grid%20view\", {\n        headers: new Headers({\n          \"Authorization\": `Bearer keyiUyROsiT6hATuI`\n        })\n      }).then( response => {\n        response.json().then( jailPopPerCap => {\n          const populationData = jailPopPerCap.records.map( (r) => {\n            return {state: r.fields.State, jailPop: r.fields[\"Jail Population per capita\"]}\n          })\n\n          render(states, populationData)\n        })\n      })\n\n    }))","import {\n  select,\n  geoAlbersUsa,\n  geoPath,\n  zoom,\n  event,\n  scaleQuantize,\n  scaleThreshold,\n  schemeBlues,\n  max\n} from 'd3';\nimport { loadAndProcessData } from './loadAndProcessData';\nimport { colorLegend } from './colorLegend';\nimport { getPopPerCap } from './airtableClient';\n\nconst colorScale = scaleQuantize().domain([1, 500]).range(schemeBlues[9])\nconst svg = select('svg');\n\nconst projection = geoAlbersUsa().scale(1100).translate([487.5, 305]);\nconst pathGenerator = geoPath()\n\nconst g = svg.append('g');\n\nsvg.call(zoom().on('zoom', () => {\n  g.attr('transform', event.transform);\n}));\nloadAndProcessData(render)\n\nfunction render(states, jailPopPerCap) {\n  console.log(states, jailPopPerCap)\n  g.selectAll('path').data(states.features)\n  .enter().append('path')\n    .attr('class', 'state')\n    .attr('d', pathGenerator)\n    .attr('fill', (d) => {\n      let stateData = jailPopPerCap.filter((r) => r.state == d.properties.name)[0]\n\n      if (stateData) {\n        console.log('in state data', jailPopPerCap)\n        d.jailPopPerCap = stateData.jailPop\n      }\n\n      if(d.jailPopPerCap) { console.log(d.jailPopPerCap) }\n      return colorScale(d.jailPopPerCap)\n  })\n}"],"names":["const","json","feature","scaleQuantize","schemeBlues","select","geoAlbersUsa","geoPath","zoom","event","let"],"mappings":"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"}