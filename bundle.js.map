{"version":3,"file":"bundle.js","sources":["loadAndProcessData.js","index.js"],"sourcesContent":["import { feature } from 'topojson';\nimport { tsv, json } from 'd3';\n\nexport const loadAndProcessData = (render =>\n  json('https://cdn.jsdelivr.net/npm/us-atlas@3/states-albers-10m.json')\n    .then((topoJSONdata) => {\n      const states = feature(topoJSONdata, topoJSONdata.objects.states);\n\n      fetch(\"https://api.airtable.com/v0/appIo1lqaLGrB5dLz/Table%201?maxRecords=100&view=Grid%20view\", {\n        headers: new Headers({\n          \"Authorization\": `Bearer keyiUyROsiT6hATuI`\n        })\n      }).then( response => {\n        response.json().then( jailPopPerCap => {\n          const populationData = jailPopPerCap.records.map( (r) => {\n            return {\n              state: r.fields.State,\n              jailPop: r.fields[\"Jail Population per capita\"],\n              avgDailyPop: r.fields[\"Average number of people in jail\"],\n              mortalityRate: r.fields[\"Mortality Rate\"]\n            }\n          })\n\n          render(states, populationData)\n        })\n      })\n\n    }))","import {\n  select,\n  geoAlbersUsa,\n  geoPath,\n  zoom,\n  mouse,\n  event,\n  scaleQuantize,\n  scaleThreshold,\n  schemeReds,\n  max\n} from 'd3';\n\nimport { legend } from './legend'\nimport { loadAndProcessData } from './loadAndProcessData';\n// import { colorLegend } from './colorLegend';\n\nconst colorScale = scaleQuantize().domain([1, 500]).range(schemeReds[9])\nconst svg = select('svg');\nconst pathGenerator = geoPath()\nconst g = svg.append('g');\n\nconst zoomBehavior = zoom().scaleExtent([.6,3]).on('zoom', () => {\n  g.attr('transform', event.transform);\n})\n\nsvg.call(zoomBehavior)\n\nconst tooltip = select(\"#map-view\").append(\"div\")\n    .attr(\"class\", \"tooltip\")\n    .style(\"opacity\", 0);\n\nconst choroplethColor = (d, states, data) => {\n  let stateData = data.filter((r) => r.state == d.properties.name)[0]\n\n  if (stateData) {\n    d.jailPopPerCap = stateData.jailPop\n    d.avgDailyPop = stateData.avgDailyPop\n    d.mortalityRate = stateData.mortalityRate\n  }\n\n  return colorScale(d.jailPopPerCap)\n}\n\nconst stateClick = (d) => {\n  console.log('clicked', d)\n}\n\nconst stateHTML = (d) => {\n  return `\n    <div class=\"state-details\">\n      <h3 class=\"w3-opacity\">${d.properties.name} </h3>\n      <div>\n        <h3 class=\"state-stat\">\n          Mortaility rate per 100,000:\n        </h3>\n        ${d.mortalityRate}\n      </div>\n      <div>\n        <h3 class=\"state-stat\">\n          Jail Population per 100,000:\n        </h3>\n        ${d.jailPopPerCap}\n      </div>\n      <div>\n        <h3 class=\"state-stat\">\n          Number of people held in jails on an average day:\n        </h3>\n        ${parseInt(d.avgDailyPop).toLocaleString()}\n      </div>\n      <div><a class=\"w3-button button-border\" \"document.getElementById('more-data-modal').style.display='block'\"> More data </a></div>\n    </div>\n  `\n}\n\nfunction render(states, jailPopPerCap) {\n  g.selectAll('path').data(states.features)\n  .enter().append('path')\n    .attr('class', 'state')\n    .attr('d', pathGenerator)\n    .attr('fill', (d) => choroplethColor(d, states, jailPopPerCap))\n    .on(\"click\", function(d) {\n      tooltip.transition()\n          .duration(500)\n          .style(\"opacity\", .9);\n      tooltip.html(stateHTML(d))\n    })\n\n  var marks = [{long: -94.3, lat: 38}];\n  svg.append(\"g\")\n    .data(marks)\n    .enter()\n    .append(\"image\")\n    .attr('class','mark')\n    .attr('width', 20)\n    .attr('height', 20)\n    .attr(\"transform\", function(d) {return \"translate(\" + pathGenerator.projection([d.long,d.lat]) + \")\";});\n}\n\nloadAndProcessData(render)\n"],"names":["const","json","feature","scaleQuantize","schemeReds","select","geoPath","zoom","event","let"],"mappings":"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"}